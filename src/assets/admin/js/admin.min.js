(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,n(r.key),r)}}function n(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,"string");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}function o(e){return e.trim().toLowerCase().replace(/\s+/g," ")}var r=function(){return n=function t(n){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.container=$(n),this.selectElement=this.container.find("select[name*='checkbox_select']"),this.memberInput=this.container.find(".member-input"),this.tabsWrapper=this.container.find(".tabs-wrapper"),this.checkboxPrefix=this.tabsWrapper.attr("data-checkbox-prefix")||"progress_reports[0][checkboxes]",this.savedCheckboxes=this.tabsWrapper.data("saved")||[],Array.isArray(this.savedCheckboxes)||"object"!==e(this.savedCheckboxes)||null===this.savedCheckboxes||(this.savedCheckboxes=Object.values(this.savedCheckboxes)),this.member=this.memberInput.val()||"",this.memberInput.on("input",(function(){o.member=o.memberInput.val(),o.updateOptions()})),this.selectElement.on("change",(function(){return o.updateOptions()})),this.updateOptions()},(r=[{key:"updateOptions",value:function(){for(var e=this,t=this.selectElement.val(),n="",r=this.savedCheckboxes.map(o),i=0;i<metaOptions.length;i++)if(metaOptions[i].hasOwnProperty(t)){var a=metaOptions[i][t];n+='<div id="'.concat(t,'" class="tab-content active"><ul>'),a.forEach((function(i){var a,c,s=(a=i.value,(c=e.member)?a.replace(/\b(the\s+)?(client|consumer)\b/gi,c):a),l="".concat(e.checkboxPrefix,"[").concat(i.index,"]"),u="".concat(e.checkboxPrefix.replace(/[\[\]]/g,"-"),"-").concat(t,"-").concat(i.index),p=-1!==r.indexOf(o(s)),d=i.heading?i.heading:"";n+='\n            <li>\n              <div style="display: block; font-size: 1.1rem; font-weight: 600; margin-bottom: 4px;">'.concat(d,'</div>\n              <div>\n                <input type="checkbox" name="').concat(l,'" id="').concat(u,'" value="').concat(s,'" ').concat(p?"checked":"",'>\n                <label for="').concat(u,'">').concat(s,"</label>\n              </div>\n            </li>\n          ")})),n+="</ul></div>";break}this.tabsWrapper.html(n)}}])&&t(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}();function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function a(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,c(o.key),o)}}function c(e){var t=function(e){if("object"!=i(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==i(t)?t:t+""}$(document).ready((function(){$(".progress-report-group").each((function(){new r(this)})),$("#add-group").on("click",(function(){var e=$(".progress-report-group").first().clone(),t=$(".progress-report-group").length;e.attr("data-index",t),e.find("input, select, textarea, label, .tabs-wrapper").each((function(){var e=$(this);$.each(["id","name","for","data-checkbox-prefix"],(function(n,o){var r=e.attr(o);r&&(r=r.replace(/\d+/,t),e.attr(o,r))}))})),$("#progress-report-repeater").append(e),new r(e)})),$("#progress-report-repeater").on("click",".remove-group",(function(){$(".progress-report-group").length>1?$(this).closest(".progress-report-group").remove():alert("At least one group is required.")}))})),jQuery(document).ready((function(e){e("#generate-pdf-button").on("click",(function(t){t.preventDefault();var n=e("#_search_member").val(),o=e("#_search_mhwin_id").val(),r=e("#_post_data").val(),i=e("#_current_post_id").val();e.ajax({url:AIOB.ajax_url,method:"POST",data:{action:"generate_pdf",nonce:AIOB.nonce,member:n,mhwin_id:o,post_data:r,post_id:i},success:function(e){e.success?alert("Email sent successfully."):alert("Error: "+e.data)},error:function(e,t,n){console.error("AJAX error:",n)}})}))}));var s=function(){return e=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$downloadButton=$(t.downloadButtonSelector||"#_download_pdf"),this.$currentPostId=$(t.currentPostIdSelector||"#_current_post_id"),this.$member=$(t.memberSelector||"#_search_member"),this.$mhwinId=$(t.mhwinIdSelector||"#_search_mhwin_id"),this.$postData=$(t.postDataSelector||"#_post_data"),this.ajaxUrl=t.ajaxUrl||"",this.bindEvents()},t=[{key:"bindEvents",value:function(){this.$downloadButton.on("click",this.handleClick.bind(this))}},{key:"handleClick",value:function(e){e.preventDefault(),e.stopPropagation();var t={action:"download_pdf",post_id:this.$currentPostId.val(),member:this.$member.val(),mhwin_id:this.$mhwinId.val(),post_data:this.$postData.val()};return $.ajax({url:this.ajaxUrl,type:"POST",data:t,xhrFields:{responseType:"blob"},success:function(e,t,n){var o=new Blob([e],{type:"application/pdf"}),r=window.URL.createObjectURL(o),i=document.createElement("a"),a=n.getResponseHeader("Content-Disposition"),c="download.pdf";if(a&&-1!==a.indexOf("attachment")){var s=/filename="([^"]+)"/.exec(a);s&&s[1]&&(c=s[1])}i.href=r,i.download=c,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(r)},error:function(){alert("Failed to download the PDF")}}),!1}}],t&&a(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function l(e){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}function u(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,p(o.key),o)}}function p(e){var t=function(e){if("object"!=l(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=l(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==l(t)?t:t+""}$(document).ready((function(){new s({ajaxUrl:AIOB.ajax_url})}));var d=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init(),this.bindAutoFill()},t=[{key:"init",value:function(){var e=this;$("#_search_member").on("keyup",(function(){var t=$("#_search_member").val();t.length>0?e.fetchMhwinIds(t):$("#_search_mhwin_id").html('<option value="">Select MHWIN ID</option>')}))}},{key:"fetchMhwinIds",value:function(e){$.ajax({url:AIOB.ajax_url,type:"POST",dataType:"json",data:{action:"fetch_mhwin_ids",member:e,security:AIOB.nonce_mhwin},success:function(e){if(e.success){var t='<option value="">Select MHWIN ID</option>';$.each(e.data,(function(e,n){t+='<option value="'+n.post_id+'">'+n.mhwin_id+"</option>"})),$("#_search_mhwin_id").html(t)}}})}},{key:"bindAutoFill",value:function(){$("#auto-fill-button").on("click",(function(e){e.preventDefault(),$(e.currentTarget).prop("disabled",!0).css({cursor:"not-allowed",opacity:"0.5"});var t=$("#_search_mhwin_id").val(),n=$("#_current_post_id").val();$.ajax({url:AIOB.ajax_url,type:"POST",dataType:"json",data:{action:"autofill_post_data",selected_post_id:t,current_post_id:n,security:AIOB.autofill_nonce},success:function(e){e.success&&(console.log("Received post data:",e.data),setTimeout((function(){location.reload()}),5e3))}})}))}}],t&&u(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();$(document).ready((function(){new d})),console.log("Admin JS loaded")})();